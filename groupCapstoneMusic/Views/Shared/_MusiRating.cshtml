@model IEnumerable<groupCapstoneMusic.Models.Musician>

<p>
    @*@Html.ActionLink("Create New", "Create")*@
    @using (Html.BeginForm("Index", "Musicians", FormMethod.Get))
</p>
    <div class"row">
        <table class="table  table-bordered table-hover" id="musiciansTable">
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.ApplicationId)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.FirstName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Email)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.City)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Zip)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Bio)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Genre)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Rating)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.SetRate)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.DatesAvailable)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.StreetAddress)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.RateCount)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.RateTotal)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Lat)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Lng)
                </th>
                <th></th>
            </tr>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.ApplicationId)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.FirstName) <br />
                            <img src="~/images/whitestar.gif" alt="Star Rating" align="middle" id="1" class="rating" mid="@item.ID" />
                            <img src="~/images/whitestar.gif" alt="Star Rating" align="middle" id="2" class="rating" mid="@item.ID" />
                            <img src="~/images/whitestar.gif" alt="Star Rating" align="middle" id="3" class="rating" mid="@item.ID" />
                            <img src="~/images/whitestar.gif" alt="Star Rating" align="middle" id="4" class="rating" mid="@item.ID" />
                            <img src="~/images/whitestar.gif" alt="Star Rating" align="middle" id="5" class="rating" mid="@item.ID" />
                            (@item.RateCount) @{if (item.RateCount > 0)
                                {
                                    decimal a = @item.RateTotal / @item.RateCount; <span class="avr"> @a</span> } }<br />
                            <div class="result"></div>
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Email)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.City)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Zip)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Bio)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Genre)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Rating)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.SetRate)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.DatesAvailable)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.StreetAddress)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.RateCount)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.RateTotal)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Lat)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Lng)
                        </td>
                        <td>
                            <div class="btn-group btn-group-xs">
                                <a href="#" class="btn btn-danger delete-row" data-item="@item.ID"><i class="fa fa-trash-o"></i></a>
                                <a href="@Url.Action("Edit", new { id = item.ID } )" class="btn btn-info"> <i class="glyphicon glyphicon-pencil"></i> Edit </a>
                                <a href="@Url.Action("Details", new { id = item.ID } )" class="btn btn-success"> <i class="glyphicon glyphicon-eye-open"></i> View </a>
                                <a href="@Url.Action("DeleteInline", new { id = item.ID } )" class="btn btn-danger" onclick="return confirm('Are you sure to delete?')"> <i class="glyphicon glyphicon-trash"></i> Delete</a>
                                @Html.ActionLink("Edit", "EditModal", "Musicians", routeValues: new { id = item.ID }, htmlAttributes: new { data_modal = "", @class = "btn btn-default" })
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <script type="text/javascript">

            $(function () {
 
        $('#musiciansTable > tbody  > tr').each(function () {
 
           var av = $(this).find("span.avr").text();
            
           if (av != "" || av != null)
           {
              // alert(av);
              // fillRating(parseInt(av));
               var img = $(this).find("img[id='" + parseInt(av) + "']");
               img.attr("src", "/images/yellowstar.gif").prevAll("img.rating").attr("src", "/images/yellowstar.gif");
           }
        });

        $(function () {
            $("img.rating").mouseover(function () {
                giveRating($(this), "yellowstar.gif");
                $(this).css("cursor", "pointer");
            });
            $("img.rating").mouseout(function () {
                giveRating($(this), "whitestar.gif");
                refilRating($(this));
            });
            $("img.rating").click(function (e) {
                // $("img.rating").unbind("mouseout mouseover click");
                $(this).css('color', 'red');
                // alert(e.currentTarget + ' was clicked!');
                // call ajax methods to update database
                var url = "/Musicians/PostRating?rating=" + parseInt($(this).attr("ID")) + "&mid=" + parseInt($(this).attr("mid"));
                $.post(url, null, function (data) {
                    $(e.currentTarget).closest('tr').find('div.result').text(data).css('color', 'red') // $("#result").text(data);
                });
            });
        });
        function giveRating(img, image) {
            img.attr("src", "/Images/" + image)
                .prevAll("img.rating").attr("src", "/Images/" + image);
        }
        function refilRating(img1) {
            var rt = $(img1).closest('tr').find("span.avr").text();
            var img = $(img1).closest('tr').find("img[id='" + parseInt(rt) + "']");
            img.attr("src", "/images/yellowstar.gif").prevAll("img.rating").attr("src", "/images/yellowstar.gif");
        }
    </script>